# Метаданные обучения

## Описание

После каждого обучения модели автоматически создается файл `training_metadata.json` в директории с результатами обучения (рядом с `test_metrics.csv`). Этот файл содержит полную информацию о процессе обучения для последующего анализа и воспроизводимости экспериментов.

## Формат файла

Файл `training_metadata.json` имеет следующую структуру:

```json
{
  "training_info": {
    "framework": "ultralytics",
    "task_type": "detection",
    "model": "yolo11n",
    "dataset": {
      "name": "HardHatSkz-1016-1061",
      "path_absolute": "/full/path/to/dataset",
      "path_relative": "../../relative/path/to/dataset"
    },
    "hyperparameters": {
      "epochs": 10,
      "batch_size": 16,
      "image_size": 640
    }
  },
  "timestamps": {
    "training": {
      "start": "2024-12-06T13:32:15.123456",
      "end": "2024-12-06T13:36:42.789012",
      "duration_seconds": 267.665556
    },
    "testing": {
      "start": "2024-12-06T13:36:43.123456",
      "end": "2024-12-06T13:37:15.789012",
      "duration_seconds": 32.665556
    }
  },
  "status": {
    "training": {
      "success": true,
      "error": null
    },
    "testing": {
      "success": true,
      "error": null
    }
  },
  "paths": {
    "model_directory": ".",
    "best_model": "train/weights/best.pt"
  }
}
```

## Поля метаданных

### training_info

- **framework**: Фреймворк для обучения (например, "ultralytics", "pytorch", "tensorflow")
- **task_type**: Тип задачи (например, "detection", "classification", "segmentation")
- **model**: Версия модели (например, "yolo11n", "resnet50")
- **dataset**: Информация о датасете
  - **name**: Имя датасета
  - **path_absolute**: Полный абсолютный путь к датасету
  - **path_relative**: Относительный путь от директории модели к датасету
- **hyperparameters**: Гиперпараметры обучения
  - **epochs**: Количество эпох
  - **batch_size**: Размер batch
  - **image_size**: Размер изображения

### timestamps

- **training**: Временные метки обучения
  - **start**: Время начала обучения (ISO 8601)
  - **end**: Время окончания обучения (ISO 8601)
  - **duration_seconds**: Длительность обучения в секундах
- **testing**: Временные метки тестирования
  - **start**: Время начала тестирования (ISO 8601)
  - **end**: Время окончания тестирования (ISO 8601)
  - **duration_seconds**: Длительность тестирования в секундах

### status

Секция содержит информацию об успешности выполнения обучения и тестирования:

- **training**: Статус обучения
  - **success**: `true` если обучение завершилось успешно, `false` если произошла ошибка
  - **error**: Сообщение об ошибке (строка) или `null` если ошибок не было. При ошибке содержит полный traceback
- **testing**: Статус тестирования
  - **success**: `true` если тестирование завершилось успешно, `false` если произошла ошибка
  - **error**: Сообщение об ошибке (строка) или `null` если ошибок не было. При ошибке содержит полный traceback

**Пример при ошибке обучения:**
```json
"status": {
  "training": {
    "success": false,
    "error": "FileNotFoundError: Папка с датасетом не найдена: /path/to/dataset\nTraceback (most recent call last):\n  ..."
  },
  "testing": {
    "success": false,
    "error": null
  }
}
```

### paths

- **model_directory**: Относительный путь к директории с результатами обучения (всегда `.`, так как файл метаданных находится в этой директории)
- **best_model**: Относительный путь к файлу лучшей модели от директории модели (`train/weights/best.pt`)

## Особенности

### Относительные пути

Функция автоматически вычисляет относительный путь от директории модели к датасету. Это полезно для:
- Переносимости метаданных между системами
- Отслеживания расположения датасета относительно модели
- Упрощения навигации по файловой системе

Все пути в секции `paths` являются относительными от директории модели (рабочей директории), что делает метаданные переносимыми и независимыми от абсолютных путей системы.

### Расширяемость

Структура метаданных спроектирована с учетом будущего расширения:
- Поле `framework` позволяет добавлять поддержку других фреймворков
- Поле `task_type` позволяет работать с разными типами задач
- Структура `hyperparameters` может быть расширена дополнительными параметрами
- Все поля опциональны и могут быть `null` при отсутствии данных

### Режим test-only

При использовании флага `--test-only` сохраняются только метаданные тестирования (без информации об обучении).

## Использование

Метаданные создаются автоматически после завершения обучения и тестирования. Файл сохраняется в той же директории, что и `test_metrics.csv`.

### Пример чтения метаданных

```python
import json

with open('training_metadata.json', 'r', encoding='utf-8') as f:
    metadata = json.load(f)

print(f"Модель: {metadata['training_info']['model']}")
print(f"Датасет: {metadata['training_info']['dataset']['name']}")
print(f"Время обучения: {metadata['timestamps']['training']['duration_seconds']} секунд")
```

## Расположение файла

Файл `training_metadata.json` сохраняется в директории модели:

```
model_directory/
├── train/
│   └── weights/
│       ├── best.pt
│       └── last.pt
├── test/
│   └── ...
├── test_metrics.csv
└── training_metadata.json  ← Здесь
```

## Именование директорий

Директории с результатами обучения автоматически получают имя с датой и временем начала обучения:

**Формат:** `{YYYY-MM-DD_HH-MM}_{model}_{epochs}epochs`

**Примеры:**
- `2024-12-06_13-32_yolo11n_10epochs`
- `2024-12-06_14-15_yolov8s_50epochs`
- `2024-12-07_09-45_yolov11m_100epochs`

Это позволяет:
- Легко идентифицировать время проведения эксперимента
- Избежать конфликтов при повторных запусках с теми же параметрами
- Хронологически упорядочивать результаты обучения

